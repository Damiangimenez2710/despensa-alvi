<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Despensa Alvi</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1a73e8">

<style>
* { box-sizing: border-box; font-family: Arial, Helvetica, sans-serif; }
body { margin: 0; background: #f1f3f4; }
header {
  display: flex; justify-content: space-between; align-items: center;
  padding: 18px 28px; background: white;
  box-shadow: 0 1px 5px rgba(0,0,0,.1);
}
header h2 { margin: 0; cursor: pointer; }
header .actions { display: flex; gap: 12px; }
header button {
  padding: 10px 16px; border-radius: 20px;
  border: none; cursor: pointer;
  background: #1a73e8; color: white;
}
header button.secondary { background: #e8eaed; color: #000; }
.container { max-width: 900px; margin: auto; padding: 20px; }
.card {
  background: white; border-radius: 16px;
  padding: 20px; margin-bottom: 20px;
  box-shadow: 0 2px 8px rgba(0,0,0,.05);
}
input, select {
  width: 100%; padding: 14px; margin-bottom: 12px;
  border-radius: 10px; border: 1px solid #ccc;
}
.soft-btn {
  width: 100%; padding: 15px;
  border-radius: 12px; border: none;
  background: #1a73e8; color: white;
  cursor: pointer; margin-top: 12px;
}
</style>
</head>

<body>

<header>
  <h2 onclick="goHome()">Despensa Alvi</h2>
  <div class="actions">
    <button onclick="showAdd()">Agregar productos</button>
    <button class="secondary" onclick="showList()">Lista de productos</button>
  </div>
</header>

<div class="container">

<div id="homeView"></div>

<div id="addView" style="display:none">
  <div class="card">
    <h3>Nuevo producto</h3>
    <input id="prodName" placeholder="Nombre del producto">
    <select id="prodCat"></select>
    <input id="prodCost" type="number" placeholder="Precio de costo">
    <button class="soft-btn" onclick="saveProduct()">Guardar producto</button>
  </div>
</div>

<div id="listView" style="display:none"></div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDzDNWaEXQR7UFWrI3r3DhVN628iGwfqfQ",
  authDomain: "despensa-alvi-c7db7.firebaseapp.com",
  projectId: "despensa-alvi-c7db7"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* NAV */
function goHome(){ homeView.style.display="block"; addView.style.display="none"; listView.style.display="none"; }
function showAdd(){ homeView.style.display="none"; addView.style.display="block"; listView.style.display="none"; }
function showList(){ homeView.style.display="none"; addView.style.display="none"; listView.style.display="block"; renderList(); }

/* ESTADO EDICI√ìN */
let editingProduct = null;

/* GUARDAR / EDITAR */
function saveProduct(){
  const name = prodName.value.trim();
  const category = prodCat.value;
  const cost = +prodCost.value;
  if(!name || !category || !cost) return;

  const data = { name, category, price: cost };

  if(editingProduct && editingProduct !== name){
    // cambi√≥ el nombre ‚Üí borrar viejo
    db.collection("products").doc(editingProduct).delete();
  }

  db.collection("products").doc(name).set(data).then(()=>{
    editingProduct = null;
    prodName.value = prodCost.value = "";
    showList();
  });
}

/* LISTA */
function renderList(){
  db.collection("products").get().then(snapshot=>{
    listView.innerHTML="";
    snapshot.forEach(doc=>{
      const p = doc.data();
      listView.innerHTML += `
        <div class="card">
          <strong>${p.name}</strong> - $${p.price}
          <button onclick="editProduct('${p.name}')">‚úèÔ∏è</button>
          <button onclick="deleteProduct('${p.name}')">üóë</button>
        </div>`;
    });
  });
}

/* EDITAR */
function editProduct(name){
  db.collection("products").doc(name).get().then(doc=>{
    const p = doc.data();
    editingProduct = name;
    showAdd();
    prodName.value = p.name;
    prodCat.value = p.category;
    prodCost.value = p.price;
  });
}

/* BORRAR */
function deleteProduct(name){
  if(confirm("¬øBorrar producto?")){
    db.collection("products").doc(name).delete().then(renderList);
  }
}
</script>

</body>
</html>
